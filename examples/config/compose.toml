listen = "0.0.0.0:7000"

backends = [
  { address = "backend-a:9000", http_version = "preserve" },
  { address = "backend-b:9000", http_version = "preserve" }
]

routes = [
  # Basic route without path manipulation
  { prefix = "/api", backend = "backend-a:9000", fingerprinting = true },
  
  # Route without fingerprinting (for fingerprint tests)
  { prefix = "/static", backend = "backend-b:9000", fingerprinting = false },
  
  # Path stripping: removes matched prefix
  # Request: /strip/users → Backend: /users
  { prefix = "/strip", backend = "backend-a:9000", fingerprinting = true, replace_path = "" },
  
  # Path rewriting: replaces prefix with new path
  # Request: /old/data → Backend: /new/data
  { prefix = "/old", backend = "backend-b:9000", fingerprinting = true, replace_path = "/new" },
  
  # Path rewriting to versioned API
  # Request: /v1/endpoint → Backend: /api/v1/endpoint
  { prefix = "/v1", backend = "backend-a:9000", fingerprinting = true, replace_path = "/api/v1" },
  
  # Default route (no path manipulation)
  { prefix = "/", backend = "backend-b:9000" }
]

[tls]
cert_path = "/config/certs/server.crt"
key_path  = "/config/certs/server.key"
alpn = ["h2", "http/1.1"]
watch_delay_secs = 60

[tls.options]
versions = ["1.2", "1.3"]
cipher_suites = [
   "TLS13_AES_128_GCM_SHA256",
   "TLS13_AES_256_GCM_SHA384",
   "TLS13_CHACHA20_POLY1305_SHA256",
   "TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256",
   "TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384",
   "TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256",
   "TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256",
   "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384",
   "TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256",
]
curve_preferences = [
   "X25519",
   "secp256r1",
   "secp384r1",
   "secp521r1",
]

[fingerprint]
tls_enabled = true
http_enabled = true
max_capture = 65536

[logging]
level = "info"
show_target = false

[timeout]
connect_ms = 5000
idle_ms = 60000
shutdown_secs = 30

[timeout.keep_alive]
enabled = true
timeout_secs = 60

[security]
max_connections = 512

[telemetry]
metrics_port = 9090
otel_log_level = "warn"
